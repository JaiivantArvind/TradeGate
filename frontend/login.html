<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TradeGate â€” Sign In</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:           #0b0f1a;
      --bg-card:      #111827;
      --bg-input:     #1a2236;
      --border:       #1f2d45;
      --border-focus: #3b82f6;
      --text:         #e2e8f0;
      --text-dim:     #64748b;
      --text-label:   #94a3b8;
      --accent:       #3b82f6;
      --accent-dim:   #1d4ed8;
      --green:        #10b981;
      --red:          #ef4444;
      --radius:       12px;
      --shadow:       0 4px 32px rgba(0,0,0,0.5);
    }

    html { font-family: 'Inter', sans-serif; font-size: 15px; }
    body {
      background: var(--bg); color: var(--text);
      min-height: 100vh; display: flex; align-items: center; justify-content: center;
      padding: 2rem 1rem;
    }

    /* â”€â”€ Page Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
      width: 100%;
      max-width: 960px;
      min-height: 560px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    /* â”€â”€ Hero (left) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero {
      background: linear-gradient(160deg, #0d1424 0%, #0b1628 60%, #0a1020 100%);
      border-right: 1px solid var(--border);
      padding: 3rem 2.5rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 2rem;
      position: relative;
      overflow: hidden;
    }

    /* subtle grid overlay */
    .hero::before {
      content: '';
      position: absolute; inset: 0;
      background-image:
        linear-gradient(rgba(59,130,246,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59,130,246,0.04) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
    }

    .hero-eyebrow {
      display: inline-flex; align-items: center; gap: 0.5rem;
      background: rgba(59,130,246,0.12); border: 1px solid rgba(59,130,246,0.25);
      color: #93c5fd; font-size: 0.68rem; font-weight: 600; letter-spacing: 0.1em;
      text-transform: uppercase; padding: 0.3rem 0.85rem; border-radius: 100px;
      width: fit-content;
    }

    .hero-logo {
      display: flex; align-items: center; gap: 0.6rem;
    }
    .hero-logo .icon { font-size: 2.5rem; line-height: 1; }
    .hero-logo h1 { font-size: 2.6rem; font-weight: 700; letter-spacing: -0.04em; }
    .hero-logo h1 span { color: var(--accent); }

    .hero-sub {
      color: var(--text-label); font-size: 0.95rem; line-height: 1.6;
      max-width: 320px;
    }

    .features { display: flex; flex-direction: column; gap: 0.9rem; }
    .feature {
      display: flex; align-items: flex-start; gap: 0.75rem;
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);
      border-radius: 8px; padding: 0.75rem 1rem;
    }
    .feature-icon { font-size: 1.2rem; line-height: 1; flex-shrink: 0; margin-top: 1px; }
    .feature-text { font-size: 0.82rem; color: var(--text-label); line-height: 1.4; }
    .feature-text strong { color: var(--text); font-weight: 500; display: block; }

    /* â”€â”€ Login Panel (right) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .login-panel {
      padding: 3rem 2.5rem;
      display: flex; flex-direction: column; justify-content: center;
    }

    .panel-title {
      font-size: 1.3rem; font-weight: 700; margin-bottom: 0.4rem;
    }
    .panel-sub {
      font-size: 0.83rem; color: var(--text-dim); margin-bottom: 2rem;
    }

    /* Tab switcher */
    .tabs {
      display: flex; background: var(--bg-input);
      border: 1px solid var(--border); border-radius: 8px;
      padding: 4px; margin-bottom: 1.75rem; gap: 4px;
    }
    .tab-btn {
      flex: 1; padding: 0.55rem 0; border: none; background: transparent;
      color: var(--text-dim); font-family: inherit; font-size: 0.85rem;
      font-weight: 500; border-radius: 6px; cursor: pointer;
      transition: background 0.18s, color 0.18s;
    }
    .tab-btn.active {
      background: var(--bg-card); color: var(--text);
      box-shadow: 0 1px 4px rgba(0,0,0,0.4);
    }

    /* Form fields */
    .form-stack { display: flex; flex-direction: column; gap: 1rem; }
    .form-group { display: flex; flex-direction: column; gap: 0.4rem; }

    label {
      font-size: 0.78rem; font-weight: 500; color: var(--text-label);
    }
    input[type="email"], input[type="password"] {
      background: var(--bg-input); border: 1px solid var(--border);
      border-radius: 7px; color: var(--text); font-family: inherit;
      font-size: 0.9rem; padding: 0.65rem 0.9rem; width: 100%;
      outline: none; transition: border-color 0.15s;
    }
    input[type="email"]:focus, input[type="password"]:focus {
      border-color: var(--border-focus);
    }
    input.input-error { border-color: var(--red) !important; }

    /* Buttons */
    .btn {
      display: flex; align-items: center; justify-content: center; gap: 0.6rem;
      border: none; border-radius: 7px; font-family: inherit;
      font-size: 0.9rem; font-weight: 600; padding: 0.75rem 1.25rem;
      width: 100%; cursor: pointer; transition: background 0.15s, opacity 0.15s;
    }
    .btn:disabled { opacity: 0.55; cursor: not-allowed; }

    .btn-primary { background: var(--accent); color: #fff; }
    .btn-primary:hover:not(:disabled) { background: var(--accent-dim); }

    .btn-google {
      background: #fff; color: #3c4043;
      border: 1px solid #dadce0;
      font-size: 0.88rem; font-weight: 500;
    }
    .btn-google:hover:not(:disabled) { background: #f8f9fa; }
    .btn-google svg { flex-shrink: 0; }

    /* Divider */
    .divider {
      display: flex; align-items: center; gap: 0.75rem;
      color: var(--text-dim); font-size: 0.75rem; margin: 0.25rem 0;
    }
    .divider::before, .divider::after {
      content: ''; flex: 1; height: 1px; background: var(--border);
    }

    /* Inline error */
    .inline-error {
      display: none;
      background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);
      color: #fca5a5; border-radius: 7px; padding: 0.7rem 0.9rem;
      font-size: 0.82rem; line-height: 1.5;
    }
    .inline-error.show { display: block; }

    /* Success message */
    .inline-success {
      display: none;
      background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.3);
      color: #6ee7b7; border-radius: 7px; padding: 0.7rem 0.9rem;
      font-size: 0.82rem; line-height: 1.5;
    }
    .inline-success.show { display: block; }

    /* Spinner */
    .spinner {
      width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff; border-radius: 50%;
      animation: spin 0.65s linear infinite; flex-shrink: 0;
    }
    .btn-google .spinner { border-color: rgba(0,0,0,0.2); border-top-color: #3c4043; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Tab panels */
    .tab-panel { display: none; }
    .tab-panel.active { display: flex; flex-direction: column; gap: 1rem; }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 680px) {
      body { align-items: flex-start; }
      .page { grid-template-columns: 1fr; max-width: 480px; margin: 0 auto; }
      .hero { border-right: none; border-bottom: 1px solid var(--border); padding: 2rem 1.5rem; }
      .hero-logo h1 { font-size: 2rem; }
      .login-panel { padding: 2rem 1.5rem; }
    }
  </style>
</head>
<body>

<div class="page">

  <!-- â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section class="hero">
    <div class="hero-eyebrow">8086 ASM Â· Flask API Â· Gemini AI</div>

    <div>
      <div class="hero-logo">
        <span class="icon">ğŸŒ</span>
        <h1>Trade<span>Gate</span></h1>
      </div>
      <p class="hero-sub" style="margin-top:0.75rem;">
        AI-Powered International Trade Tariff Calculator
      </p>
    </div>

    <div class="features">
      <div class="feature">
        <span class="feature-icon">âš¡</span>
        <div class="feature-text">
          <strong>Real-time tariff rates via Gemini AI</strong>
          Live lookups powered by Google's Gemini model
        </div>
      </div>
      <div class="feature">
        <span class="feature-icon">ğŸ”©</span>
        <div class="feature-text">
          <strong>Computed by 8086 Assembly Engine</strong>
          Duty arithmetic runs on a real x86 ASM core
        </div>
      </div>
      <div class="feature">
        <span class="feature-icon">ğŸŒ</span>
        <div class="feature-text">
          <strong>20 trade routes, 8 goods categories</strong>
          Covering major global economies and sectors
        </div>
      </div>
    </div>
  </section>

  <!-- â”€â”€ Login Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section class="login-panel">
    <div class="panel-title">Welcome back</div>
    <div class="panel-sub">Sign in to access your trade calculator</div>

    <!-- Tab switcher -->
    <div class="tabs" role="tablist">
      <button class="tab-btn active" role="tab" data-tab="signin" id="tab-signin">Sign In</button>
      <button class="tab-btn"        role="tab" data-tab="signup" id="tab-signup">Sign Up</button>
    </div>

    <!-- â”€â”€ Sign In tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-panel active" id="panel-signin">
      <div class="form-stack">
        <div class="form-group">
          <label for="si-email">Email</label>
          <input type="email" id="si-email" placeholder="you@example.com" autocomplete="email" />
        </div>
        <div class="form-group">
          <label for="si-password">Password</label>
          <input type="password" id="si-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />
        </div>
        <button class="btn btn-primary" id="btn-signin">Sign In</button>
      </div>

      <div class="divider">or</div>

      <button class="btn btn-google" id="btn-google-signin">
        <!-- Google "G" SVG -->
        <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z" fill="#4285F4"/>
          <path d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z" fill="#34A853"/>
          <path d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/>
          <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 6.29C4.672 4.163 6.656 3.58 9 3.58z" fill="#EA4335"/>
        </svg>
        Continue with Google
      </button>

      <div class="inline-error" id="si-error"></div>
    </div>

    <!-- â”€â”€ Sign Up tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="tab-panel" id="panel-signup">
      <div class="form-stack">
        <div class="form-group">
          <label for="su-email">Email</label>
          <input type="email" id="su-email" placeholder="you@example.com" autocomplete="email" />
        </div>
        <div class="form-group">
          <label for="su-password">Password</label>
          <input type="password" id="su-password" placeholder="Min. 6 characters" autocomplete="new-password" />
        </div>
        <div class="form-group">
          <label for="su-confirm">Confirm Password</label>
          <input type="password" id="su-confirm" placeholder="Re-enter password" autocomplete="new-password" />
        </div>
        <button class="btn btn-primary" id="btn-signup">Create Account</button>
      </div>

      <div class="divider">or</div>

      <button class="btn btn-google" id="btn-google-signup">
        <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z" fill="#4285F4"/>
          <path d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z" fill="#34A853"/>
          <path d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/>
          <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 6.29C4.672 4.163 6.656 3.58 9 3.58z" fill="#EA4335"/>
        </svg>
        Continue with Google
      </button>

      <div class="inline-error"   id="su-error"></div>
      <div class="inline-success" id="su-success"></div>
    </div>

  </section>
</div>

<script type="module" src="auth.js"></script>
<script type="module">
  // â”€â”€ Session redirect on load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  window.addEventListener('load', async () => {
    // Wait for Auth to be available (auth.js sets window.Auth)
    await new Promise(r => {
      if (window.Auth) return r();
      const t = setInterval(() => { if (window.Auth) { clearInterval(t); r(); } }, 20);
    });

    const session = await Auth.getSession();
    if (session) {
      const country = await Auth.getCountry();
      window.location.href = country ? '/index.html' : '/settings.html';
    }
  });

  // â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('panel-' + btn.dataset.tab).classList.add('active');
      clearErrors();
    });
  });

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setLoading(btn, on, label) {
    btn.disabled = on;
    btn.innerHTML = on
      ? `<span class="spinner"></span>${label}`
      : label;
  }
  function showError(el, msg) {
    el.textContent = msg;
    el.classList.add('show');
  }
  function clearErrors() {
    document.querySelectorAll('.inline-error, .inline-success').forEach(el => {
      el.textContent = '';
      el.classList.remove('show');
    });
    document.querySelectorAll('input').forEach(i => i.classList.remove('input-error'));
  }
  function postSignInRedirect(user) {
    const country = user?.user_metadata?.home_country;
    window.location.href = country ? '/index.html' : '/settings.html';
  }

  // â”€â”€ Sign In â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('btn-signin').addEventListener('click', async () => {
    const btn   = document.getElementById('btn-signin');
    const email = document.getElementById('si-email').value.trim();
    const pass  = document.getElementById('si-password').value;
    const errEl = document.getElementById('si-error');
    clearErrors();

    if (!email || !pass) {
      showError(errEl, 'Please enter your email and password.');
      if (!email) document.getElementById('si-email').classList.add('input-error');
      if (!pass)  document.getElementById('si-password').classList.add('input-error');
      return;
    }

    setLoading(btn, true, 'Signing inâ€¦');
    const { user, error } = await Auth.signInWithEmail(email, pass);
    setLoading(btn, false, 'Sign In');

    if (error) { showError(errEl, error.message); return; }
    postSignInRedirect(user);
  });

  // â”€â”€ Sign Up â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('btn-signup').addEventListener('click', async () => {
    const btn     = document.getElementById('btn-signup');
    const email   = document.getElementById('su-email').value.trim();
    const pass    = document.getElementById('su-password').value;
    const confirm = document.getElementById('su-confirm').value;
    const errEl   = document.getElementById('su-error');
    const okEl    = document.getElementById('su-success');
    clearErrors();

    if (!email || !pass || !confirm) {
      showError(errEl, 'Please fill in all fields.');
      if (!email)   document.getElementById('su-email').classList.add('input-error');
      if (!pass)    document.getElementById('su-password').classList.add('input-error');
      if (!confirm) document.getElementById('su-confirm').classList.add('input-error');
      return;
    }
    if (pass !== confirm) {
      showError(errEl, 'Passwords do not match.');
      document.getElementById('su-password').classList.add('input-error');
      document.getElementById('su-confirm').classList.add('input-error');
      return;
    }
    if (pass.length < 6) {
      showError(errEl, 'Password must be at least 6 characters.');
      document.getElementById('su-password').classList.add('input-error');
      return;
    }

    setLoading(btn, true, 'Creating accountâ€¦');
    const { user, error } = await Auth.signUpWithEmail(email, pass);
    setLoading(btn, false, 'Create Account');

    if (error) { showError(errEl, error.message); return; }
    okEl.textContent = 'âœ… Check your email to confirm your account.';
    okEl.classList.add('show');
  });

  // â”€â”€ Google OAuth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function handleGoogle(btn, loadLabel) {
    setLoading(btn, true, loadLabel);
    await Auth.signInWithGoogle();
    // redirect happens via OAuth; re-enable in case of popup cancel
    setTimeout(() => setLoading(btn, false, loadLabel.replace('Redirectingâ€¦', 'Continue with Google')), 3000);
  }

  document.getElementById('btn-google-signin').addEventListener('click', function () {
    handleGoogle(this, 'Redirectingâ€¦');
  });
  document.getElementById('btn-google-signup').addEventListener('click', function () {
    handleGoogle(this, 'Redirectingâ€¦');
  });
</script>

</body>
</html>

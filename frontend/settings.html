<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TradeGate â€” Settings</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:           #0b0f1a;
      --bg-card:      #111827;
      --bg-input:     #1a2236;
      --border:       #1f2d45;
      --border-focus: #3b82f6;
      --text:         #e2e8f0;
      --text-dim:     #64748b;
      --text-label:   #94a3b8;
      --accent:       #3b82f6;
      --accent-dim:   #1d4ed8;
      --green:        #10b981;
      --red:          #ef4444;
      --red-dim:      #991b1b;
      --radius:       10px;
      --shadow:       0 4px 24px rgba(0,0,0,0.4);
    }

    html { font-family: 'Inter', sans-serif; font-size: 15px; }
    body { background: var(--bg); color: var(--text); min-height: 100vh; }

    /* â”€â”€ Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    nav {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 2rem; height: 58px;
      background: var(--bg-card); border-bottom: 1px solid var(--border);
      position: sticky; top: 0; z-index: 10;
    }

    .nav-logo {
      display: flex; align-items: center; gap: 0.5rem;
      text-decoration: none; color: var(--text);
    }
    .nav-logo .icon { font-size: 1.4rem; line-height: 1; }
    .nav-logo span  { font-size: 1.1rem; font-weight: 700; letter-spacing: -0.02em; }
    .nav-logo span em { color: var(--accent); font-style: normal; }

    .nav-right { display: flex; align-items: center; gap: 0.75rem; }

    .nav-link {
      color: var(--text-label); text-decoration: none;
      font-size: 0.85rem; font-weight: 500; padding: 0.45rem 0.85rem;
      border-radius: 6px; border: 1px solid var(--border);
      transition: color 0.15s, border-color 0.15s, background 0.15s;
    }
    .nav-link:hover { color: var(--text); border-color: var(--border-focus); background: rgba(59,130,246,0.07); }

    .nav-signout {
      font-size: 0.85rem; font-weight: 500; padding: 0.45rem 0.85rem;
      border-radius: 6px; border: 1px solid var(--border);
      background: transparent; color: var(--text-dim);
      font-family: inherit; cursor: pointer;
      transition: color 0.15s, border-color 0.15s;
    }
    .nav-signout:hover { color: var(--red); border-color: var(--red); }

    /* â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    main {
      display: flex; justify-content: center; align-items: flex-start;
      padding: 3rem 1rem 4rem;
    }

    .settings-card {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      width: 100%; max-width: 480px;
      overflow: hidden;
    }

    /* card header */
    .card-header {
      padding: 1.75rem 2rem 1.5rem;
      border-bottom: 1px solid var(--border);
    }
    .card-header h1 {
      font-size: 1.2rem; font-weight: 700; margin-bottom: 0.25rem;
    }
    .card-header p {
      font-size: 0.82rem; color: var(--text-dim);
    }

    /* sections */
    .card-section {
      padding: 1.6rem 2rem;
      border-bottom: 1px solid var(--border);
    }
    .card-section:last-child { border-bottom: none; }

    .section-label {
      font-size: 0.68rem; font-weight: 600; letter-spacing: 0.1em;
      text-transform: uppercase; color: var(--text-dim);
      margin-bottom: 1.1rem;
      display: flex; align-items: center; gap: 0.5rem;
    }
    .section-label::before {
      content: ''; display: inline-block; width: 3px; height: 12px;
      background: var(--accent); border-radius: 2px;
    }

    /* profile row */
    .profile-row {
      display: flex; flex-direction: column; gap: 0.35rem;
    }
    .profile-row .field-label {
      font-size: 0.78rem; font-weight: 500; color: var(--text-label);
    }
    .email-display {
      background: var(--bg-input); border: 1px solid var(--border);
      border-radius: 7px; padding: 0.65rem 0.9rem;
      font-size: 0.9rem; color: var(--text-dim);
      user-select: all; letter-spacing: 0.01em;
    }

    /* country section */
    .field-desc {
      font-size: 0.8rem; color: var(--text-dim); line-height: 1.5;
      margin-bottom: 0.9rem; margin-top: -0.4rem;
    }

    .form-group { display: flex; flex-direction: column; gap: 0.4rem; margin-bottom: 1rem; }
    .form-group:last-child { margin-bottom: 0; }

    label.field-label { font-size: 0.78rem; font-weight: 500; color: var(--text-label); }

    select {
      appearance: none;
      background: var(--bg-input);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%2364748b' d='M1 1l5 5 5-5'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 0.9rem center;
      border: 1px solid var(--border); border-radius: 7px;
      color: var(--text); font-family: inherit; font-size: 0.9rem;
      padding: 0.65rem 2.2rem 0.65rem 0.9rem; width: 100%;
      outline: none; transition: border-color 0.15s; cursor: pointer;
    }
    select:focus { border-color: var(--border-focus); }

    /* buttons */
    .btn {
      display: flex; align-items: center; justify-content: center; gap: 0.55rem;
      border: none; border-radius: 7px; font-family: inherit;
      font-size: 0.9rem; font-weight: 600; padding: 0.75rem 1.25rem;
      width: 100%; cursor: pointer; transition: background 0.15s, opacity 0.15s;
    }
    .btn:disabled { opacity: 0.55; cursor: not-allowed; }

    .btn-primary { background: var(--accent); color: #fff; }
    .btn-primary:hover:not(:disabled) { background: var(--accent-dim); }

    .btn-danger {
      background: transparent; color: var(--red);
      border: 1px solid rgba(239,68,68,0.4);
    }
    .btn-danger:hover:not(:disabled) {
      background: rgba(239,68,68,0.08); border-color: var(--red);
    }

    /* feedback messages */
    .msg {
      border-radius: 7px; padding: 0.65rem 0.9rem;
      font-size: 0.82rem; line-height: 1.5; margin-top: 0.85rem;
      display: none;
    }
    .msg.show { display: block; }
    .msg-success {
      background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.3);
      color: #6ee7b7;
    }
    .msg-error {
      background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);
      color: #fca5a5;
    }

    /* spinner */
    .spinner {
      width: 15px; height: 15px; border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff; border-radius: 50%;
      animation: spin 0.65s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* loading skeleton for email */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-input) 25%, #1e2a3d 50%, var(--bg-input) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.2s infinite;
      border-radius: 7px; height: 42px;
    }
    @keyframes shimmer { to { background-position: -200% 0; } }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 520px) {
      nav { padding: 0 1rem; }
      .card-header, .card-section { padding-left: 1.25rem; padding-right: 1.25rem; }
    }
  </style>
</head>
<body>

<!-- â”€â”€ Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<nav>
  <a class="nav-logo" href="/index.html">
    <span class="icon">ğŸŒ</span>
    <span>Trade<em>Gate</em></span>
  </a>
  <div class="nav-right">
    <a class="nav-link" href="/index.html">âš¡ Calculator</a>
    <button class="nav-signout" id="nav-signout">Sign Out</button>
  </div>
</nav>

<!-- â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<main>
  <div class="settings-card">

    <!-- Card header -->
    <div class="card-header">
      <h1>Account Settings</h1>
      <p>Manage your profile and preferences</p>
    </div>

    <!-- Section 1: Profile -->
    <div class="card-section">
      <div class="section-label">Profile</div>
      <div class="profile-row">
        <span class="field-label">Logged in as</span>
        <div class="email-display skeleton" id="email-display"></div>
      </div>
    </div>

    <!-- Section 2: Home Country -->
    <div class="card-section">
      <div class="section-label">Home Country</div>
      <p class="field-desc">
        This will pre-fill the Exporter field in the calculator so you don't have to select it every time.
      </p>
      <div class="form-group">
        <label class="field-label" for="country-select">Your Country</label>
        <select id="country-select">
          <option value="" disabled selected>Select your country</option>
          <option value="1">ğŸ‡ºğŸ‡¸ USA</option>
          <option value="2">ğŸ‡¨ğŸ‡³ China</option>
          <option value="3">ğŸ‡®ğŸ‡³ India</option>
          <option value="4">ğŸ‡©ğŸ‡ª Germany</option>
          <option value="5">ğŸ‡¯ğŸ‡µ Japan</option>
          <option value="6">ğŸ‡°ğŸ‡· South Korea</option>
          <option value="7">ğŸ‡»ğŸ‡³ Vietnam</option>
          <option value="8">ğŸ‡²ğŸ‡¾ Malaysia</option>
          <option value="9">ğŸ‡¬ğŸ‡§ UK</option>
          <option value="10">ğŸ‡«ğŸ‡· France</option>
        </select>
      </div>
      <button class="btn btn-primary" id="btn-save">Save Settings</button>
      <div class="msg msg-success" id="msg-success">âœ… Settings saved! Redirecting to calculatorâ€¦</div>
      <div class="msg msg-error"   id="msg-error"></div>
    </div>

    <!-- Section 3: Danger Zone -->
    <div class="card-section">
      <div class="section-label">Danger Zone</div>
      <button class="btn btn-danger" id="btn-signout">Sign Out</button>
    </div>

  </div>
</main>

<script type="module" src="auth.js"></script>
<script type="module">
  // â”€â”€ Wait for Auth module â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  await new Promise(r => {
    if (window.Auth) return r();
    const t = setInterval(() => { if (window.Auth) { clearInterval(t); r(); } }, 20);
  });

  // â”€â”€ Auth gate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const user = await Auth.requireAuth();
  if (!user) throw new Error('Not authenticated'); // requireAuth redirects; this is a safety stop

  // â”€â”€ Populate profile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const emailEl = document.getElementById('email-display');
  emailEl.classList.remove('skeleton');
  emailEl.textContent = user.email ?? 'â€”';

  // â”€â”€ Pre-select saved country â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const savedCountry = await Auth.getCountry();
  if (savedCountry) {
    document.getElementById('country-select').value = String(savedCountry);
  }

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setLoading(btn, on, label) {
    btn.disabled = on;
    btn.innerHTML = on ? `<span class="spinner"></span>${label}` : label;
  }
  function showMsg(el, show) {
    document.querySelectorAll('.msg').forEach(m => m.classList.remove('show'));
    if (show) el.classList.add('show');
  }

  // â”€â”€ Save Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('btn-save').addEventListener('click', async () => {
    const btn       = document.getElementById('btn-save');
    const countryId = parseInt(document.getElementById('country-select').value);
    const errEl     = document.getElementById('msg-error');
    const okEl      = document.getElementById('msg-success');

    if (!countryId) {
      errEl.textContent = 'Please select a country before saving.';
      showMsg(errEl, true);
      return;
    }

    setLoading(btn, true, 'Savingâ€¦');
    const { error } = await Auth.saveCountry(countryId);
    setLoading(btn, false, 'Save Settings');

    if (error) {
      errEl.textContent = error.message ?? 'Failed to save settings. Please try again.';
      showMsg(errEl, true);
      return;
    }

    showMsg(okEl, true);
    setTimeout(() => { window.location.href = '/index.html'; }, 2000);
  });

  // â”€â”€ Sign Out (both buttons) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ['nav-signout', 'btn-signout'].forEach(id => {
    document.getElementById(id).addEventListener('click', () => Auth.signOut());
  });
</script>

</body>
</html>
